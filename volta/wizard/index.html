<!DOCTYPE HTML>
<html>
    <head>
        <link rel="stylesheet" href="/static/style.css">
        <link rel="stylesheet" href="/static/bootstrap.min.css">
        <link rel="stylesheet" href="/static/checkboxes.css">
        <script type="text/javascript" src="https://yastatic.net/jquery/3.1.0/jquery.min.js"></script>
        <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet">
        <script type="text/javascript">
            function WizardWebSocket() {
                $("#message").text = '';
                if ("WebSocket" in window) {
                    var ws = new WebSocket("ws://localhost:9998/wizard");
                    var config = {};
                    config.duration = document.getElementById("duration").value;
                    events = document.getElementById('events');
                    upload = document.getElementById('upload');

                    if (events.checked) {
                        config.events = true;
                    }
                    else {
                        config.events = false;
                    }
                    if (upload.checked) {
                        config.upload = true;
                    }
                    else {
                        config.upload = false;
                    }
                    json_cfg = JSON.stringify(config)

                    ws.onopen = function() {
                        $("#message").append('Opened new connection to wizard...<br>');
                        // Web Socket is connected, send data using send()
                        ws.send(json_cfg);
                    };
                    ws.onmessage = function (evt) {
                        var received_msg = JSON.parse(evt.data);
                        if (received_msg.type == 'message') {
                            $("#message").append('<li>' + received_msg.message + '</li>');
                        }
                        else {
                            $("#debug").append('<li>'+received_msg.message+'</li>');
                        }
                    };
                    ws.onclose = function() {
                        // websocket is closed.
                        $("#message").append('Connection to wizard closed...<br>');
                    };
                }
                else {
                    // The browser doesn't support WebSocket
                    alert("WebSocket NOT supported by your Browser!");
                }
            }
        </script>
        
    </head>
    <body>
        <div class="container bgcont center-block">
            <div class="row">
                <div id="configs" class="col-md-4">
                    <div class="row">
                        <label for="duration">Длительность теста</label>
                        <input id="duration" name="duration" type="text" label="duration">
                    </div>
                    <div class="row">
                        <label for="events">Записывать эвенты с телефона?</label>
                        <input id="events" name="events" type="checkbox" label="events">
                    </div>
                    <div class="row">
                        <label for="upload">Залить логи в Лунапарк?</label>
                        <input id="upload" name="upload" type="checkbox" label="upload" checked>
                    </div>
                    <div class="row">
                        <button onclick="WizardWebSocket();" class="btn btn-primary btn-lg">Run Wizard</button>
                    </div>
                </div>
                <div id="message" class="panel panel-info col-md-8 pre-scrollable" style="max-height: 50%;">
                    <!-- output messages here -->
                </div>
            </div>
            <div class="footer navbar-fixed-bottom panel panel-warning pre-scrollable" style="max-height: 50%;">
                <div id="debug" class="col-md-12">
                    <!-- debug message here --> Console output:
                </div>
            </div>
        </div>
    </body>
</html>
